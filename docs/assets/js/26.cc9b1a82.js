(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{326:function(s,a,t){"use strict";t.r(a);var e=t(14),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"安装维护"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装维护"}},[s._v("#")]),s._v(" 安装维护")]),s._v(" "),a("h2",{attrs:{id:"🍷-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🍷-准备工作"}},[s._v("#")]),s._v(" 🍷 准备工作")]),s._v(" "),a("ul",[a("li",[s._v("安装"),a("code",[s._v("docker")]),s._v("（若已安装请跳过）；"),a("a",{attrs:{href:"https://yeasy.gitbook.io/docker_practice/install/ubuntu#shi-yong-jiao-ben-zi-dong-an-zhuang",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文档"),a("OutboundLink")],1),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 0. 先清除与docker相关的残余软件包（适用于多次安装docker失败的情况）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" remove "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" docker-engine docker.io containerd runc\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 使用官方脚本安装docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" update\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-fsSL")]),s._v(" https://get.docker.com "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--mirror")]),s._v(" Aliyun\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 启动docker服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3. 查看版本以验证是否安装成功")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version\n")])])])]),s._v(" "),a("li",[s._v("如遇拉取镜像总是失败或超时，可"),a("strong",[s._v("更换docker镜像源")]),s._v("。"),a("br"),s._v("\n编辑文件"),a("code",[s._v("/etc/docker/daemon.json")]),s._v("："),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/docker/daemon.json\n")])])]),s._v("按"),a("code",[s._v("i")]),s._v("进入编辑模式，在文件中输入以下内容："),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://mirror.baidubce.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://hub-mirror.c.163.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ustc-edu-cn.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docker.mirrors.ustc.edu.cn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://registry.docker-cn.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),s._v("按"),a("code",[s._v("Esc")]),s._v("键退出编辑模式，并输入命令"),a("code",[s._v(":wq")]),s._v("保存文件。"),a("br"),s._v("\n重启docker让配置生效："),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl daemon-reload\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl restart "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"🔨-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🔨-部署"}},[s._v("#")]),s._v(" 🔨 部署")]),s._v(" "),a("h4",{attrs:{id:"_1-获取部署脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取部署脚本"}},[s._v("#")]),s._v(" 1. 获取部署脚本")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 1. 创建项目文件夹并进入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" OnlineJudge\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" OnlineJudge\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 2. 下载部署脚本和配置文件, 注意-O是大写字母O.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" https://gitee.com/winant/OnlineJudge/raw/master/install/docker-compose.yml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" https://gitee.com/winant/OnlineJudge/raw/master/install/lduoj.conf\n")])])]),a("h4",{attrs:{id:"_2-启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动服务"}},[s._v("#")]),s._v(" 2. 启动服务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("\n")])])]),a("ul",[a("li",[s._v("访问首页"),a("code",[s._v("http://ip:8080")]),s._v("(该端口在"),a("code",[s._v("docker-compose.yml")]),s._v("中配置)；可在宿主机"),a("RouterLink",{attrs:{to:"/deploy/network.html"}},[s._v("配置域名")]),s._v("；")],1),s._v(" "),a("li",[s._v("默认管理员用户："),a("code",[s._v("admin")]),s._v("，默认密码"),a("code",[s._v("adminadmin")]),s._v("，务必更改默认密码；")])]),s._v(" "),a("h2",{attrs:{id:"💿-备份-迁移"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#💿-备份-迁移"}},[s._v("#")]),s._v(" 💿 备份/迁移")]),s._v(" "),a("h3",{attrs:{id:"备份"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#备份"}},[s._v("#")]),s._v(" 备份")]),s._v(" "),a("p",[s._v("将整个项目文件夹打包备份：")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose down  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 务必先停止服务")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意是在项目文件夹 OnlineJudge/ 的外层执行备份")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-cf")]),s._v(" - ./OnlineJudge "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" pigz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("nproc"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" lduoj20230623.tar.gz\n")])])]),a("h3",{attrs:{id:"恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#恢复"}},[s._v("#")]),s._v(" 恢复")]),s._v(" "),a("h4",{attrs:{id:"_1-解压备份包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-解压备份包"}},[s._v("#")]),s._v(" 1. 解压备份包")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-zxvf")]),s._v(" lduoj20230623.tar.gz  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" lduoj20230623 OnlineJudge    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目文件夹改一下名字")]),s._v("\n")])])]),a("h4",{attrs:{id:"_2-启动服务-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动服务-2"}},[s._v("#")]),s._v(" 2. 启动服务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" OnlineJudge             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入项目文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\n")])])]),a("h2",{attrs:{id:"🚗-更新升级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#🚗-更新升级"}},[s._v("#")]),s._v(" 🚗 更新升级")]),s._v(" "),a("h4",{attrs:{id:"_1-备份数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-备份数据"}},[s._v("#")]),s._v(" 1. 备份数据")]),s._v(" "),a("p",[s._v("升级之前，务必备份！因不备份造成的数据损失，后果自负。")]),s._v(" "),a("h4",{attrs:{id:"_2-获取最新部署脚本-会直接覆盖旧文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-获取最新部署脚本-会直接覆盖旧文件"}},[s._v("#")]),s._v(" 2. 获取最新部署脚本（会直接覆盖旧文件）")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" OnlineJudge  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入项目文件夹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载部署脚本和配置文件, 注意-O是大写字母O. 会覆盖旧文件，请提前备份")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" https://gitee.com/winant/OnlineJudge/raw/master/install/docker-compose.yml\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" https://gitee.com/winant/OnlineJudge/raw/master/install/lduoj.conf\n")])])]),a("h4",{attrs:{id:"_3-拉取最新镜像-并启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-拉取最新镜像-并启动服务"}},[s._v("#")]),s._v(" 3. 拉取最新镜像，并启动服务")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose pull web  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新web镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" compose up "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);